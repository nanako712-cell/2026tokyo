<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>TOKYO & FUJI TRIP 2026</title>
<link rel="manifest" href="manifest.json">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="theme-color" content="#1A1A1A">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500&family=Shippori+Mincho:wght@400;500;600&display=swap" rel="stylesheet">
<style>
    /* åŸºç¤æ¨£å¼ */
    :root {
        --bg: #F9F9F9;
        --card-bg: #FFFFFF;
        --text-main: #1A1A1A;
        --text-sub: #8C8C8C;
        --accent: #A6A6A6;
        --line: #EFEFEF;
        --shadow: 0 4px 20px rgba(0,0,0,0.03);
    }
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body { font-family: 'Shippori Mincho', 'Noto Sans JP', serif; background-color: var(--bg); color: var(--text-main); margin: 0; padding-bottom: 80px; -webkit-font-smoothing: antialiased; letter-spacing: 0.05em; }
    .icon { width: 18px; height: 18px; stroke: currentColor; fill: none; stroke-width: 1.5; vertical-align: middle; }
    .icon-sm { width: 14px; height: 14px; }
    
    /* Header */
    header { background: var(--bg); padding-top: 20px; text-align: center; position: sticky; top: 0; z-index: 100; }
    header.scrolled .date-scroller { border-bottom: 1px solid var(--line); box-shadow: var(--shadow); }
    .trip-tag { font-family: 'Noto Sans JP', sans-serif; font-size: 10px; color: var(--text-sub); text-transform: uppercase; letter-spacing: 0.2em; margin-bottom: 5px; display: block; }
    h1 { font-size: 20px; font-weight: 500; margin: 0 0 15px 0; }
    
    /* Date Scroller */
    .date-scroller { display: flex; overflow-x: auto; padding: 10px 20px; gap: 20px; scrollbar-width: none; background: var(--bg); border-bottom: 1px solid transparent; transition: border 0.3s; }
    .date-scroller::-webkit-scrollbar { display: none; }
    .date-item { display: flex; flex-direction: column; align-items: center; min-width: 45px; opacity: 0.4; transition: 0.3s; cursor: pointer; }
    .date-item.active { opacity: 1; transform: scale(1.05); }
    .date-item .dow { font-size: 9px; font-family: 'Noto Sans JP'; font-weight: 500; margin-bottom: 4px; }
    .date-item .day { font-size: 18px; font-family: 'Shippori Mincho'; font-weight: 600; }
    .date-item.active .day { border-bottom: 2px solid #a33e3e; padding-bottom: 2px; }
    
    /* Hero & Weather */
    .hero { position: relative; margin: 10px 20px 20px 20px; border-radius: 4px; overflow: hidden; height: 200px; box-shadow: var(--shadow); }
    .hero img { width: 100%; height: 100%; object-fit: cover; }
    .hero-text { position: absolute; bottom: 0; left: 0; width: 100%; padding: 20px; background: linear-gradient(to top, rgba(0,0,0,0.6), transparent); color: white; }
    .hero-title { font-size: 22px; font-weight: 500; text-shadow: 0 2px 4px rgba(0,0,0,0.3); }
    .hero-subtitle { font-size: 11px; font-family: 'Noto Sans JP'; opacity: 0.9; margin-top: 5px; display: flex; align-items: center; gap: 5px;}
    .weather-row { display: flex; justify-content: space-between; padding: 0 25px 20px 25px; margin-bottom: 10px; border-bottom: 1px solid var(--line); }
    .weather-col { display: flex; flex-direction: column; align-items: center; gap: 5px; }
    .weather-time { font-size: 10px; color: var(--text-sub); font-family: 'Noto Sans JP'; }
    .weather-temp { font-size: 14px; font-weight: 500; }
    
    /* Cards */
    .container { padding: 0 20px; }
    .timeline-item { position: relative; padding-left: 20px; margin-bottom: 30px; animation: fadeIn 0.4s ease; }
    .time-badge { font-family: 'Shippori Mincho'; font-size: 24px; font-weight: 400; margin-bottom: 8px; display: flex; align-items: baseline; gap: 8px; }
    .time-badge span { font-size: 12px; color: var(--text-sub); font-family: 'Noto Sans JP'; border: 1px solid var(--text-sub); padding: 1px 6px; border-radius: 2px; }
    .card { background: var(--card-bg); border-radius: 2px; padding: 20px; box-shadow: var(--shadow); border: 1px solid #F5F5F5; }
    .card-title { font-size: 18px; font-weight: 600; margin-bottom: 5px; letter-spacing: 0.08em; }
    .card-loc { font-size: 11px; color: var(--text-sub); margin-bottom: 15px; font-family: 'Noto Sans JP'; display: flex; align-items: center; gap: 4px; }
    .info-block { background: #F8F8F8; padding: 12px 15px; margin-bottom: 10px; border-radius: 2px; display: flex; justify-content: space-between; align-items: center; }
    .info-label { font-size: 9px; color: var(--text-sub); text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 2px; }
    .info-value { font-size: 14px; font-weight: 500; font-family: 'Noto Sans JP'; }
    .desc { font-size: 13px; line-height: 1.8; color: #555; font-family: 'Noto Sans JP'; margin-top: 15px; padding-top: 15px; border-top: 1px dashed var(--line); }
    .tag { font-size: 10px; display: inline-block; width: fit-content; padding: 2px 8px; border-radius: 4px; margin-bottom: 5px; color: white; font-family: 'Noto Sans JP'; font-weight: 500;}
    .tag-food { background: #E91E63; } /* Pink/Red for food */
    .tag-spot { background: #2196F3; } /* Blue for spot */
    .tag-trans { background: #FF9800; } /* Orange for transport */
    .tag-stay { background: #4CAF50; } /* Green for stay */
    .tag-shop { background: #A0522D; } /* Brown for shop */
    .btn-nav { display: flex; align-items: center; justify-content: center; width: 100%; background: #1A1A1A; color: white; padding: 12px 0; border-radius: 2px; text-decoration: none; font-size: 12px; font-family: 'Noto Sans JP'; margin-top: 15px; gap: 8px; }
    .add-btn-float { position: fixed; bottom: 100px; right: 20px; background: #a33e3e; color: white; border: none; width: 50px; height: 50px; border-radius: 50%; box-shadow: 0 4px 10px rgba(0,0,0,0.2); z-index: 150; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: transform 0.2s; }
    .add-btn-float:hover { transform: scale(1.1); }
    .add-btn-float svg { width: 24px; height: 24px; stroke: white; fill: none; stroke-width: 2;}

    /* Budget & Category Styles */
    .budget-header { text-align: center; padding: 40px 20px; background: white; margin-bottom: 20px; box-shadow: var(--shadow); }
    .budget-total-label { font-size: 12px; color: var(--text-sub); margin-bottom: 5px; }
    .budget-total-amount { font-size: 36px; font-weight: 500; }
    .budget-input-group { background: white; padding: 0 20px 20px 20px; margin: 0 20px; box-shadow: var(--shadow); border-radius: 2px; }
    .b-input { width: 100%; border: none; border-bottom: 1px solid #ddd; padding: 10px 0; font-family: 'Noto Sans JP'; font-size: 14px; margin-bottom: 15px; border-radius: 0; }
    .b-btn { width: 100%; background: #1A1A1A; color: white; border: none; padding: 12px; font-size: 12px; cursor: pointer; }
    
    /* Category Selector (Budget) */
    .category-selector { display: flex; justify-content: space-between; padding: 10px 20px; margin-bottom: 15px; border-top: 1px solid #eee; border-bottom: 1px solid #eee; background: #fff; }
    .category-selector input[type="radio"] { display: none; }
    .category-selector label { flex-grow: 1; text-align: center; padding: 8px 0; cursor: pointer; font-size: 10px; color: #888; background: #fff; border-radius: 4px; margin: 0 2px; transition: all 0.2s; display: flex; flex-direction: column; align-items: center; user-select: none; }
    .category-selector input[type="radio"]:checked + label { background: #eaf1ed; color: #1A1A1A; font-weight: 600; }
    .category-selector label svg { margin-bottom: 3px; width: 20px; height: 20px; stroke: #888; fill: none; stroke-width: 1.5; }
    .category-selector input[type="radio"]:checked + label svg { stroke: #388E3C; }

    /* Expense List */
    .expense-list { list-style: none; padding: 0; margin: 20px 0; background: #fff; }
    .expense-item { display: flex; justify-content: space-between; align-items: center; padding: 12px 20px; border-bottom: 1px solid #eee; background: #fff; }
    .expense-item-left { display: flex; align-items: center; gap: 12px; }
    .expense-icon-circle { width: 32px; height: 32px; border-radius: 50%; background: #f5f5f5; display: flex; align-items: center; justify-content: center; }
    .expense-icon-circle svg { width: 16px; height: 16px; stroke: #555; fill: none; stroke-width: 1.5; }
    .expense-info { display: flex; flex-direction: column; }
    .expense-name { font-size: 14px; font-weight: 500; color: #333; }
    .expense-cat-name { font-size: 10px; color: #999; }
    .expense-amount { font-size: 16px; font-weight: 600; color: #1A1A1A; }
    .delete-btn { color: #ccc; margin-left: 10px; cursor: pointer; font-size: 18px; line-height: 1; }

    /* Modal for Itinerary Editing */
    .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 250; display: none; justify-content: center; align-items: flex-end; }
    .modal-content { background: white; width: 100%; max-width: 600px; border-radius: 10px 10px 0 0; padding: 20px; animation: slideUp 0.3s ease-out; }
    .modal-content h2 { font-size: 20px; margin-top: 0; margin-bottom: 15px; font-weight: 600; }
    .modal-input { width: 100%; border: 1px solid #ddd; padding: 10px; margin-bottom: 15px; border-radius: 4px; font-family: 'Noto Sans JP'; }
    .modal-input-group { display: flex; gap: 10px; margin-bottom: 15px; }
    .modal-input-group input { flex: 1; }
    .modal-select { padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-family: 'Noto Sans JP'; }
    .modal-actions { display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px; }
    .modal-btn-cancel { background: #DDD; color: #555; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; }
    .modal-btn-save { background: #388E3C; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; }

    /* Tags for Editing Modal */
    .edit-tags-group { display: flex; gap: 10px; margin-bottom: 15px; }
    .edit-tags-group input[type="radio"] { display: none; }
    .edit-tags-group label { flex: 1; text-align: center; padding: 8px 5px; border-radius: 4px; font-size: 12px; cursor: pointer; opacity: 0.7; transition: opacity 0.2s; }
    .edit-tags-group input[type="radio"]:checked + label { opacity: 1; border: 2px solid; }
    .tag-edit-food { background: #F8BBD0; color: #E91E63; }
    .tag-edit-food input[type="radio"]:checked + label { border-color: #E91E63; }
    .tag-edit-spot { background: #BBDEFB; color: #2196F3; }
    .tag-edit-spot input[type="radio"]:checked + label { border-color: #2196F3; }
    .tag-edit-trans { background: #FFE0B2; color: #FF9800; }
    .tag-edit-trans input[type="radio"]:checked + label { border-color: #FF9800; }
    .tag-edit-stay { background: #C8E6C9; color: #4CAF50; }
    .tag-edit-stay input[type="radio"]:checked + label { border-color: #4CAF50; }
    .tag-edit-shop { background: #FFCCBC; color: #A0522D; } /* Light Brown for shop */

    @keyframes slideUp {
        from { transform: translateY(100%); }
        to { transform: translateY(0); }
    }
    
    /* Bottom Nav */
    .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; background: rgba(255,255,255,0.95); backdrop-filter: blur(10px); border-top: 1px solid var(--line); display: flex; justify-content: space-around; padding: 10px 0; padding-bottom: max(10px, env(safe-area-inset-bottom)); z-index: 200; }
    .nav-btn { background: none; border: none; display: flex; flex-direction: column; align-items: center; gap: 4px; font-family: 'Noto Sans JP'; font-size: 9px; color: #AAA; cursor: pointer; flex: 1; }
    .nav-btn.active { color: #1A1A1A; }
    .nav-btn svg { stroke-width: 1.2; }
    .nav-btn.active svg { stroke-width: 2; }
    
    .page { display: none; }
    .page.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
</style>
</head>
<body>

<header id="main-header">
    <span class="trip-tag">TOKYO & FUJI TRIP 2026</span>
    <h1 id="page-title">Day 1 | è’²ç”°å…¥ä½</h1>
    
    <div class="date-scroller" id="dateScroller">
        <div class="date-item active" onclick="switchDay(1)"><span class="dow">SAT</span><span class="day">07</span></div>
        <div class="date-item" onclick="switchDay(2)"><span class="dow">SUN</span><span class="day">08</span></div>
        <div class="date-item" onclick="switchDay(3)"><span class="dow">MON</span><span class="day">09</span></div>
        <div class="date-item" onclick="switchDay(4)"><span class="dow">TUE</span><span class="day">10</span></div>
        <div class="date-item" onclick="switchDay(5)"><span class="dow">WED</span><span class="day">11</span></div>
        <div class="date-item" onclick="switchDay(6)"><span class="dow">THU</span><span class="day">12</span></div>
        <div class="date-item" onclick="switchDay(7)"><span class="dow">FRI</span><span class="day">13</span></div>
    </div>
</header>

<div id="itinerary-container" class="container">
    <div id="itinerary-timeline" style="padding-left: 20px;">
        </div>
    <button class="add-btn-float" onclick="openAddModal()">
        <svg viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
    </button>
</div>

<div id="tools" class="page" style="background: #F9F9F9;">
    <div class="budget-header">
        <h2 style="margin:0; font-weight:500;">æ—…ç¨‹è³‡è¨Š</h2>
    </div>
    <div class="container">
        
        <div class="card" style="margin-bottom:20px; padding: 15px 20px;">
            <div class="card-title" style="border-bottom:1px solid #eee; padding-bottom:10px; margin-bottom:15px;">Visit Japan Web å…¥å¢ƒè³‡æ–™</div>
            
            <div id="vjwDisplay">
                <strong style="display:block; margin-bottom: 5px; font-family: 'Noto Sans JP', sans-serif;">ç¶²ç«™é€£çµ (ä¸€éµé–‹å•Ÿ)</strong>
                <a id="vjwLinkDisplay" href="#" target="_blank" class="btn-nav" style="margin-top: 8px; margin-bottom: 15px; padding: 8px 0; font-size: 11px;">å‰å¾€ VJW ç™»å…¥é é¢</a>
                
                <strong style="display:block; margin-bottom: 5px; font-family: 'Noto Sans JP', sans-serif;">QR Code åœ–ç‰‡</strong>
                <div id="vjwQrCodeContainer" style="text-align:center; padding:15px; border: 1px dashed #ddd; margin-bottom:15px; display:none; background: #FFF;">
                    <img id="vjwQrCodeImg" src="" style="width:100%; max-width:200px; height:auto; background: #fff; padding: 10px; border-radius: 2px;">
                </div>
                <button id="vjwQrCodeToggle" class="btn-nav" onclick="toggleQrCodeDisplay()" style="margin-top: 8px; margin-bottom: 15px; padding: 8px 0; font-size: 11px; background:#4CAF50;">é¡¯ç¤º/éš±è— QR Code åœ–ç‰‡</button>
                
                <div style="text-align:right; margin-top:15px; border-top: 1px dashed var(--line); padding-top:10px;">
                    <span style="font-size:12px; color:#999; cursor:pointer;" onclick="toggleVjwEditMode(true)">âœï¸ ç·¨è¼¯è³‡æ–™</span>
                </div>
            </div>
            
            <div id="vjwEdit" style="display:none;">
                <label for="vjwLinkInput" style="font-size:12px; color:#555; display:block; margin-bottom:5px; font-family: 'Noto Sans JP', sans-serif;">VJW ç™»å…¥é€£çµ (å¿…å¡«)</label>
                <input type="url" id="vjwLinkInput" class="modal-input" placeholder="ä¾‹å¦‚: https://vjw.digital.go.jp/...">
                
                <label for="vjwQrInput" style="font-size:12px; color:#555; display:block; margin-bottom:5px; font-family: 'Noto Sans JP', sans-serif;">QR Code åœ–ç‰‡é€£çµ (é¸å¡«)</label>
                <input type="url" id="vjwQrInput" class="modal-input" placeholder="ä¾‹å¦‚: https://imgur.com/your-qrcode.png">
                <p style="font-size:10px; color:#777; margin-top:-10px; margin-bottom:15px; font-family: 'Noto Sans JP', sans-serif;">è«‹å°‡ QR Code æˆªåœ–ä¸Šå‚³è‡³åœ–åºŠï¼Œç„¶å¾Œè²¼ä¸Šé€£çµã€‚</p>
                
                <div class="modal-actions" style="margin-top:0;">
                    <button class="modal-btn-cancel" onclick="toggleVjwEditMode(false)">å–æ¶ˆ</button>
                    <button class="modal-btn-save" style="background:#2196F3;" onclick="saveVJWData()">å„²å­˜</button>
                </div>
            </div>
        </div>
        <div class="card" style="margin-bottom:20px; padding: 15px 20px;">
            <div class="card-title" style="border-bottom:1px solid #eee; padding-bottom:10px; margin-bottom:15px;">èˆªç­è³‡è¨Š</div>
            <div style="background:#F7F7F7; padding:15px; border-radius:4px; margin-bottom: 20px;">
                <div style="font-size:11px; color:#555; margin-bottom: 12px;">2 æœˆ 7 æ—¥ é€±å…­ | JL802</div>
                <div style="display:flex; justify-content:space-between; align-items:flex-start;">
                    <div style="text-align:left;"><div style="font-size:24px; font-weight:600;">10:55</div><div style="font-size:12px; color:#555;">TPE T2</div></div>
                    <div style="text-align:center; flex-grow:1; padding-top:5px;"><div style="font-size:10px; color:#999;">3h 00m</div></div>
                    <div style="text-align:right;"><div style="font-size:24px; font-weight:600;">14:55</div><div style="font-size:12px; color:#555;">NRT T2</div></div>
                </div>
            </div>
            <div style="background:#F7F7F7; padding:15px; border-radius:4px;">
                <div style="font-size:11px; color:#555; margin-bottom: 12px;">2 æœˆ 13 æ—¥ é€±äº” | JL809</div>
                <div style="display:flex; justify-content:space-between; align-items:flex-start;">
                    <div style="text-align:left;"><div style="font-size:24px; font-weight:600;">18:05</div><div style="font-size:12px; color:#555;">NRT T2</div></div>
                    <div style="text-align:center; flex-grow:1; padding-top:5px;"><div style="font-size:10px; color:#999;">4h 05m</div></div>
                    <div style="text-align:right;"><div style="font-size:24px; font-weight:600;">21:10</div><div style="font-size:12px; color:#555;">TPE T2</div></div>
                </div>
            </div>
        </div>

        <div class="card" style="margin-bottom:20px;">
            <div class="card-title" style="border-bottom:1px solid #eee; padding-bottom:10px; margin-bottom:15px;">ä½å®¿æ¸…å–®</div>
            <div class="desc" style="line-height:1.6;">
                <strong style="display:block; margin-bottom: 5px;">Day 1, 2, 4-7: <a href="http://galleryfutari.com/" target="_blank" style="color:#1A1A1A;">Gallery House 1&2</a></strong>
                <span style="display:block; font-size:12px; color:#555;">æ—¥æœ¬ã€’146-0095 Tokyo, Ota City, Tamagawa</span>
                <a href="https://maps.google.com/?q=Gallery+House+Kamata" class="btn-nav" target="_blank" style="margin-top: 8px; margin-bottom: 15px; padding: 8px 0; font-size: 11px; background:#444;">åœ°åœ–å°èˆª</a>
                <hr style="border: none; border-top: 1px dashed #eee; margin: 15px 0;">
                <strong style="display:block; margin-bottom: 5px;">Day 3: <a href="http://www.mifujien.co.jp/" target="_blank" style="color:#1A1A1A;">Hotel ç¾å†¨å£«åœ’</a></strong>
                <span style="display:block; font-size:12px; color:#555;">207 Azagawa, Fujikawaguchiko</span>
                <a href="https://maps.app.goo.gl/tjFVmaV9dbPPNdfF7" class="btn-nav" target="_blank" style="margin-top: 8px; padding: 8px 0; font-size: 11px; background:#444;">åœ°åœ–å°èˆª</a>
            </div>
        </div>
    </div>
</div>

<div id="budget" class="page" style="background: #F9F9F9;">
    <div class="budget-header">
        <div class="budget-total-label">TOTAL EXPENSES</div>
        <div class="budget-total-amount">Â¥<span id="totalAmount">0</span></div>
    </div>
    <div class="category-selector">
        <input type="radio" id="cat-food" name="expense-cat" value="food" checked><label for="cat-food"><svg viewBox="0 0 24 24"><path d="M12 2l7 3v4a9 9 0 0 1-7 8 9 9 0 0 1-7-8V5z"/></svg>é¤é£²</label>
        <input type="radio" id="cat-shop" name="expense-cat" value="shop"><label for="cat-shop"><svg viewBox="0 0 24 24"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 0 1-8 0"/></svg>è³¼ç‰©</label>
        <input type="radio" id="cat-trans" name="expense-cat" value="trans"><label for="cat-trans"><svg viewBox="0 0 24 24"><path d="M10 16.5c0 .83-.67 1.5-1.5 1.5s-1.5-.67-1.5-1.5.67-1.5 1.5-1.5 1.5.67 1.5 1.5z"/><path d="M17.5 16.5c0 .83-.67 1.5-1.5 1.5s-1.5-.67-1.5-1.5.67-1.5 1.5-1.5 1.5.67 1.5 1.5z"/><path d="M5 20h14"/></svg>äº¤é€š</label>
        <input type="radio" id="cat-stay" name="expense-cat" value="stay"><label for="cat-stay"><svg viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>ä½å®¿</label>
        <input type="radio" id="cat-other" name="expense-cat" value="other"><label for="cat-other"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>å…¶ä»–</label>
    </div>
    <div class="budget-input-group">
        <input type="text" id="budgetItem" class="b-input" placeholder="æ¶ˆè²»é …ç›® (ä¾‹å¦‚: æ‹‰éºµ)">
        <input type="number" id="budgetAmount" class="b-input" placeholder="é‡‘é¡ (JPY)">
        <button class="b-btn" onclick="addExpense()">æ–°å¢ç´€éŒ„</button>
    </div>
    <div style="text-align:center; padding: 10px 20px;">
        <button class="b-btn" onclick="exportExpensesToCSV()" style="background:#555; margin-bottom: 10px; font-size: 14px;">åŒ¯å‡ºè‡³ Excel/è©¦ç®—è¡¨</button>
    </div>
    <div id="exportOutput" style="display:none; margin: 0 20px 20px; padding: 10px; background: #fff; border: 1px dashed #ccc; border-radius: 2px;">
        <p style="font-size:12px; margin-bottom: 5px; color:#555;">è«‹è¤‡è£½ä»¥ä¸‹æ–‡å­—è²¼åˆ° Excelï¼š</p>
        <textarea id="csvData" style="width:100%; height:120px; font-size:12px; font-family: monospace; border: 1px solid #ddd; padding: 5px;"></textarea>
    </div>
    <ul id="expenseList" class="expense-list" style="margin: 0; background: #fff;"></ul>
    <div style="text-align:center; padding: 30px 0;">
        <button onclick="clearBudget()" style="background:none; border:none; color:#999; text-decoration:underline; font-size:11px;">æ¸…é™¤æ‰€æœ‰ç´€éŒ„</button>
    </div>
</div>

<nav class="bottom-nav">
    <button class="nav-btn active" onclick="switchMainTab('itinerary', this)">
        <svg class="icon icon-lg" viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>è¡Œç¨‹
    </button>
    <button class="nav-btn" onclick="switchMainTab('tools', this)">
        <svg class="icon icon-lg" viewBox="0 0 24 24"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/></svg>è³‡è¨Š
    </button>
    <button class="nav-btn" onclick="switchMainTab('budget', this)">
        <svg class="icon icon-lg" viewBox="0 0 24 24"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>è¨˜å¸³
    </button>
</nav>

<div id="addModal" class="modal-overlay" onclick="if(event.target.id === 'addModal') closeModal()">
    <div class="modal-content">
        <h2>æ–°å¢è¡Œç¨‹é …ç›® (Day <span id="modalDayNum">1</span>)</h2>
        <input type="time" id="itemTime" class="modal-input-group" value="10:00" required>
        <input type="text" id="itemTitle" class="modal-input" placeholder="æ¨™é¡Œ (å¿…å¡«)">
        <input type="text" id="itemDesc" class="modal-input" placeholder="è©³ç´°èªªæ˜/å‚™è¨» (å¯é¸)">
        <input type="url" id="itemLink" class="modal-input" placeholder="Google Map æˆ– ç¶²ç«™é€£çµ (å¯é¸)">

        <div class="edit-tags-group">
            <input type="radio" id="tag-edit-spot" name="itemTag" value="spot" checked>
            <label for="tag-edit-spot" class="tag-edit-spot">æ™¯é»/æ´»å‹•</label>
            
            <input type="radio" id="tag-edit-food" name="itemTag" value="food">
            <label for="tag-edit-food" class="tag-edit-food">é¤é£²/ç¾é£Ÿ</label>
            
            <input type="radio" id="tag-edit-stay" name="itemTag" value="stay">
            <label for="tag-edit-stay" class="tag-edit-stay">ä½å®¿/ä¼‘æ¯</label>

            <input type="radio" id="tag-edit-trans" name="itemTag" value="trans">
            <label for="tag-edit-trans" class="tag-edit-trans">äº¤é€š/ç§»å‹•</label>

            <input type="radio" id="tag-edit-shop" name="itemTag" value="shop">
            <label for="tag-edit-shop" class="tag-edit-shop">è³¼ç‰©</label>
        </div>

        <div class="modal-actions">
            <button class="modal-btn-cancel" onclick="closeModal()">å–æ¶ˆ</button>
            <button class="modal-btn-save" onclick="saveNewItem()">å„²å­˜ä¸¦æ–°å¢</button>
        </div>
    </div>
</div>

<script>
    // --- åˆå§‹è¡Œç¨‹è³‡æ–™ (å¦‚æœ localStorage æ²’æœ‰ï¼Œå°±ä½¿ç”¨é€™ä»½) ---
    const initialItineraryData = {
        1: { hero: { img: "https://raw.githubusercontent.com/nanako712-cell/2026tokyo/main/91820028.jpg", title: "æŠµé”æˆç”°", subtitle: "è’²ç”°å…¥ä½" }, items: [
            { time: "14:55", title: "JL802 æŠµé”æˆç”° (NRT)", desc: "å…¥å¢ƒã€é ˜è¡Œæã€è²·äº¤é€šå¡ã€‚16:15 æ­ NEX æˆç”°ç‰¹å¿«å‰å¾€å“å·ã€‚", tag: "trans", link: "" },
            { time: "18:00", title: "Gallery House å…¥ä½", desc: "æŠµé”ä½å®¿é»ï¼Œæ•´ç†è¡Œæèˆ‡ä¼‘æ¯ã€‚", tag: "stay", link: "https://maps.google.com/?q=Gallery+House+Kamata" },
            { time: "19:00", title: "è’²ç”°æ‹‰éºµ/æº«æ³‰ æ“‡ä¸€", desc: "è’²ç”°æ‹‰éºµï¼ˆå®¶ç³»/å…­å˜èˆ/éºµåŒ ï¼‰æˆ– è’²ç”°æº«æ³‰ï¼ˆä¾¿å®œå¥½æ³¡ï¼‰ã€‚", tag: "food", link: "" },
        ]},
        2: { hero: { img: "https://res.klook.com/images/fl_lossy.progressive,q_65/c_fill,w_1200,h_630/w_80,x_15,y_15,g_south_west,l_Klook_water_br_trans_yhcmh3/activities/oycn53bquvcaeq8aabjl/%E6%A9%AB%E6%BF%B1%E7%A7%81%E4%BA%BA%E5%8D%8A%E6%97%A5%E9%81%8A.jpg", title: "æ©«æ¿± Minato Mirai", subtitle: "å®¶åº­å‹å–„" }, items: [
            { time: "09:30", title: "æ¸¯æœªä¾† Minato Mirai æ•£ç­–", desc: "å¤§æ‘©å¤©è¼ª Cosmo Clock 21ã€Queenâ€™s Squareã€æµ·é‚Šæ‹ç…§ã€‚", tag: "spot", link: "" },
            { time: "12:00", title: "åˆé¤ (ç´…ç£šå€‰åº«æˆ– Queenâ€™s Square)", desc: "ç´…ç£šå€‰åº«å…§ bills é¬†é¤…æˆ–æ©«æ¿±ãŸã¡ã°ãªäº­è›‹åŒ…é£¯ã€‚", tag: "food", link: "" },
            { time: "13:10", title: "æ©«æ¿±ç´…ç£šå€‰åº«", desc: "æ‹ç…§ã€å¸‚é›†ã€è³¼ç‰©ã€‚åˆ¥å¿˜äº†å´é™½è»’çš„ç´…ç£šç‡’è³£ï¼", tag: "spot", link: "" },
            { time: "15:15", title: "æ¯éºµåšç‰©é¤¨", desc: "å­©å­ä¸€å®šè¶…æ„›è‡ªå·±åšæ¯éºµã€‚", tag: "spot", link: "" },
        ]},
        3: { hero: { img: "https://photo.s3.com.tw/look/Upload/BlogArticleImages/18740/20230315105948403_700_0_80.jpg", title: "å¯Œå£«å±±å¤§æ™¯æ—¥", subtitle: "æ²³å£æ¹–å…¥ä½" }, items: [
            { time: "09:00", title: "å‰å¾€æ²³å£æ¹– (é€€æˆ¿)", desc: "è’²ç”°â†’å“å·â†’å¤§æœˆï¼ˆJRç‰¹æ€¥ï¼‰â†’æ²³å£æ¹–ï¼ˆå¯Œå£«æ€¥ï¼‰ã€‚", tag: "trans", link: "" },
            { time: "12:00", title: "åˆé¤ | é¤ºé£¥è— æ­¥æˆ", desc: "å±±æ¢¨ç¸£ç‰¹è‰²éºµé£Ÿã€Œé¤ºé£¥ã€ã€‚", tag: "food", link: "" },
            { time: "13:15", title: "å¤§çŸ³å…¬åœ’ & æœ¨ä¹‹èŠ±ç¾è¡“é¤¨", desc: "æœ€å®¹æ˜“æ‹åˆ°å¯Œå£«å±±å…¨æ™¯ï¼ŒäºŒæœˆç©é›ªæ©Ÿæœƒé«˜ã€‚", tag: "spot", link: "" },
            { time: "17:00", title: "ç¾å¯Œå£«åœ’é£¯åº— å…¥ä½", desc: "æ™šé¤ã€æ³¡æ¹¯ã€ä¼‘æ¯ã€‚", tag: "stay", link: "http://www.mifujien.co.jp/" },
        ]},
        4: { hero: { img: "https://tw.wamazing.com/media/wp-content/uploads/sites/4/2025/03/dramahotspot_pixta_99069846_M.jpg", title: "æ²³å£æ¹–åŠæ—¥éŠ", subtitle: "è¿”å›æ±äº¬" }, items: [
            { time: "09:30", title: "æ²³å£æ·ºé–“ç¥ç¤¾", desc: "æ£®æ—èƒ½é‡æ™¯é»ã€‚è‹¥éšæ¢¯çµå†°ï¼Œåœ¨å‰é¢æ‹ç…§å³å¯ã€‚", tag: "spot", link: "" },
            { time: "11:00", title: "å¯Œå£«å‰ç”°æ‡·èˆŠå•†åº—è¡—", desc: "æ˜­å’Œé¢¨è€è¡—å·¡ç¦®ã€‚", tag: "spot", link: "" },
            { time: "12:00", title: "åˆé¤ | å‰ç”°çƒé¾éºµ", desc: "ç•¶åœ°ç‰¹è‰²ç¡¬éºµï¼Œæ¨è–¦é¦¬è‚‰çƒé¾éºµã€‚", tag: "food", link: "" },
            { time: "14:00", title: "è¿”å›è’²ç”°", desc: "æ²³å£æ¹–ç«™â†’å¤§æœˆâ†’å“å·â†’è’²ç”°ã€‚é è¨ˆ 17:00 æŠµé”ã€‚", tag: "trans", link: "" },
        ]},
        5: { hero: { img: "https://raw.githubusercontent.com/nanako712-cell/2026tokyo/main/DSCF2199.jpg", title: "æ·ºè‰ãƒ»æ™´ç©ºå¡”", subtitle: "æœ€é †æš¢è·¯ç·š" }, items: [
            { time: "11:00", title: "æ·ºè‰å¯ºï¼‹ä»²è¦‹ä¸–é€šã‚Š", desc: "æ–‡åŒ–è§€å…‰ä¸­å¿ƒå±•æœ›å°ï¼ˆå…è²»ï¼‰ã€èŠ±æœˆå ‚è è˜¿éºµåŒ…ã€‚", tag: "spot", link: "" },
            { time: "13:00", title: "æ™´ç©ºå¡”å‰åˆé¤", desc: "å‘¨é‚Šæœ‰è¨±å¤šç¾é£Ÿé¸æ“‡ã€‚", tag: "food", link: "" },
            { time: "14:00", title: "æ™´ç©ºå¡” & Solamachi å•†å ´", desc: "å±•æœ›å° (è‹¥æœ‰é ç´„)ã€å…’ç«¥éŠæˆ²å€ã€‚", tag: "spot", link: "" },
        ]},
        6: { hero: { img: "https://raw.githubusercontent.com/nanako712-cell/2026tokyo/main/33710023.JPG", title: "éƒ½å¿ƒç¶“å…¸ç·š", subtitle: "æ¾€è°·ãƒ»å…­æœ¬æœ¨" }, items: [
            { time: "09:00", title: "é£›é³¥å±±å…¬åœ’", desc: "äº¬æ¿±æ±åŒ—ç·šç›´é”ï¼Œé©åˆå­©å­ç©æ¨‚ã€‚", tag: "spot", link: "" },
            { time: "10:30", title: "æ¾€è°·ç«™å‰ (å…«å…¬ & åå­—è·¯å£)", desc: "å¯åŠ  Shibuya Sky (+1 å°æ™‚)ã€‚", tag: "spot", link: "" },
            { time: "12:10", title: "æ˜æ²»ç¥å®®", desc: "æ£®æ—ç³»èƒ½é‡ã€ç©ºæ°£ä¹¾æ·¨ã€‚", tag: "spot", link: "" },
            { time: "13:30", title: "è¡¨åƒé“åˆé¤ (A to Z / Bills)", desc: "åœ¨æ™‚å°šå€äº«ç”¨åˆé¤ã€‚", tag: "food", link: "" },
            { time: "15:00", title: "å…­æœ¬æœ¨ä¹‹ä¸˜ & æ±äº¬éµå¡”", desc: "å…­æœ¬æœ¨å±•æœ›å°çœ‹å¤•é™½èˆ‡å¤œæ™¯ï¼Œç„¶å¾Œè½‰å¾€æ±äº¬éµå¡”ã€‚", tag: "spot", link: "" },
        ]},
        7: { hero: { img: "https://raw.githubusercontent.com/nanako712-cell/2026tokyo/main/DSCF2584.jpg", title: "è¿”ç¨‹æ—¥", subtitle: "18:05 NRT T2 èµ·é£›" }, items: [
            { time: "09:00", title: "å¯é¸è¡Œç¨‹ï¼šç¾½ç”°ç©ºæ¸¯å±•æœ›å°", desc: "æœ€æ¨è–¦ï¼Œè¿‘ã€å¥½æ‹ã€å­©å­æ„›ã€‚", tag: "spot", link: "" },
            { time: "09:00", title: "å¯é¸è¡Œç¨‹ï¼šä¸Šé‡é˜¿ç¾æ©«ç”º/æ±äº¬è»Šç«™", desc: "å¿«é€Ÿè£œè—¥å¦æˆ–è²·è§’è‰²å‘¨é‚Š/ä¼´æ‰‹ç¦®ã€‚", tag: "shop", link: "" },
            { time: "12:00", title: "åˆé¤ & æ‰“åŒ…", desc: "åœ¨è’²ç”°å‘¨é‚Šæˆ–ç¾½ç”°æ©Ÿå ´è§£æ±ºåˆé¤ï¼Œä¸¦é ç•™æ™‚é–“å›æˆ¿æ”¶æ‹¾ã€‚", tag: "food", link: "" },
            { time: "15:00", title: "å‰å¾€æˆç”°æ©Ÿå ´", desc: "å¾è’²ç”°å‡ºç™¼ï¼Œæ­ NEX æˆ–äº¬æˆç·šã€‚", tag: "trans", link: "" },
        ]},
    };
    
    let currentDay = 1;
    let itineraryData = {};
    const dayTitles = { 1: 'Day 1 | è’²ç”°å…¥ä½', 2: 'Day 2 | æ©«æ¿±ä¸€æ—¥', 3: 'Day 3 | æ²³å£æ¹–å¤§æ™¯', 4: 'Day 4 | è¿”å›æ±äº¬', 5: 'Day 5 | æ·ºè‰ãƒ»æ™´ç©ºå¡”', 6: 'Day 6 | éƒ½å¿ƒç¶“å…¸ç·š', 7: 'Day 7 | è¿”ç¨‹æ—¥' };
    const tagClasses = { food: 'tag-food', spot: 'tag-spot', trans: 'tag-trans', stay: 'tag-stay', shop: 'tag-shop' };
    const tagNames = { food: 'ğŸœ é¤é£²ç¾é£Ÿ', spot: 'ğŸ æ™¯é»æ´»å‹•', trans: 'ğŸš„ äº¤é€šç§»å‹•', stay: 'ğŸ¨ ä½å®¿ä¼‘æ¯', shop: 'ğŸ› è³¼ç‰©è¡€æ‹¼' };

    // --- åˆå§‹åŒ–å’Œè³‡æ–™è¼‰å…¥ ---
    window.addEventListener('DOMContentLoaded', () => {
        loadItineraryFromLocalStorage();
        loadVJWData(); // ã€NEWã€‘è¼‰å…¥ VJW è³‡æ–™
        switchDay(1); // é è¨­é¡¯ç¤º Day 1
        loadExpenses();
    });

    function saveItineraryToLocalStorage() {
        localStorage.setItem('tripItinerary', JSON.stringify(itineraryData));
    }

    function loadItineraryFromLocalStorage() {
        const storedData = localStorage.getItem('tripItinerary');
        if (storedData) {
            itineraryData = JSON.parse(storedData);
        } else {
            itineraryData = initialItineraryData;
            saveItineraryToLocalStorage();
        }
    }

    // --- VJW è³‡æ–™é‚è¼¯ (NEW) ---
    function loadVJWData() {
        // é è¨­é€£çµæ˜¯ VJW ç™»å…¥é é¢
        const data = JSON.parse(localStorage.getItem('vjwData')) || { 
            link: 'https://vjw.digital.go.jp/login', 
            qrCode: '' 
        };
        
        // ç·¨è¼¯æ¨¡å¼æ¬„ä½å¡«å€¼
        document.getElementById('vjwLinkInput').value = data.link;
        document.getElementById('vjwQrInput').value = data.qrCode;
        
        // é¡¯ç¤ºæ¨¡å¼æ›´æ–°
        const linkDisplay = document.getElementById('vjwLinkDisplay');
        const qrImg = document.getElementById('vjwQrCodeImg');
        const qrToggleBtn = document.getElementById('vjwQrCodeToggle');

        linkDisplay.href = data.link;
        linkDisplay.innerText = data.link ? 'å‰å¾€ VJW ç™»å…¥é é¢' : 'VJW ç™»å…¥é é¢ (æœªè¨­å®š)';
        linkDisplay.style.background = data.link ? '#1A1A1A' : '#A6A6A6';
        
        qrImg.src = data.qrCode || '';
        document.getElementById('vjwQrCodeContainer').style.display = 'none'; // é è¨­éš±è—

        if (!data.qrCode) {
            qrToggleBtn.innerText = 'æœªè¨­å®š QR Code åœ–ç‰‡';
            qrToggleBtn.style.background = '#A6A6A6';
            qrToggleBtn.disabled = true; // æ²’åœ–å°±ä¸èƒ½æŒ‰
        } else {
            qrToggleBtn.innerText = 'é¡¯ç¤º/éš±è— QR Code åœ–ç‰‡';
            qrToggleBtn.style.background = '#4CAF50';
            qrToggleBtn.disabled = false;
        }
    }

    function saveVJWData() {
        const link = document.getElementById('vjwLinkInput').value.trim();
        const qrCode = document.getElementById('vjwQrInput').value.trim();
        
        if (!link) {
            alert('VJW ç™»å…¥é€£çµæ˜¯å¿…å¡«çš„å–”ï¼');
            return;
        }

        const data = { link, qrCode };
        localStorage.setItem('vjwData', JSON.stringify(data));
        loadVJWData();
        toggleVjwEditMode(false);
        alert('Visit Japan Web è³‡æ–™å·²å„²å­˜ï¼');
    }

    function toggleVjwEditMode(isEdit) {
        document.getElementById('vjwDisplay').style.display = isEdit ? 'none' : 'block';
        document.getElementById('vjwEdit').style.display = isEdit ? 'block' : 'none';
        if (!isEdit) {
            loadVJWData(); // å–æ¶ˆæ™‚é‡è¼‰è³‡æ–™
        }
    }

    function toggleQrCodeDisplay() {
        const container = document.getElementById('vjwQrCodeContainer');
        const toggleBtn = document.getElementById('vjwQrCodeToggle');
        
        if (container.style.display === 'none') {
            container.style.display = 'block';
            toggleBtn.innerText = 'éš±è— QR Code åœ–ç‰‡';
        } else {
            container.style.display = 'none';
            toggleBtn.innerText = 'é¡¯ç¤º QR Code åœ–ç‰‡';
        }
    }
    // --- VJW è³‡æ–™é‚è¼¯ (END) ---


    // --- è¡Œç¨‹æ¸²æŸ“é‚è¼¯ (èˆ‡ä¸Šä¸€å€‹ç‰ˆæœ¬ç›¸åŒ) ---
    function renderItinerary(dayNum) {
        currentDay = dayNum;
        const data = itineraryData[dayNum];
        const timeline = document.getElementById('itinerary-timeline');
        timeline.innerHTML = '';

        // æ¸²æŸ“ Hero å€å¡Š
        document.querySelector('#itinerary-container').innerHTML = `
            <div class="hero">
                <img src="${data.hero.img}" alt="${data.hero.title}">
                <div class="hero-text">
                    <div class="hero-title">${data.hero.title}</div>
                    <div class="hero-subtitle">${data.hero.subtitle}</div>
                </div>
            </div>
            <div class="weather-row">
                <div class="weather-col"><span class="weather-time">é ä¼°</span><svg class="icon" viewBox="0 0 24 24"><path d="M17.5 19c0-1.7-1.3-3-3-3h-11a4 4 0 0 1-.8-7.9 5 5 0 0 1 9.8-1.2 3 3 0 0 1 5 1.7"/></svg><span class="weather-temp">14Â°C</span></div>
                <div class="weather-col"><span class="weather-time">é»æ“Š</span><svg class="icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="5"/><path d="M12 1v2m0 18v2M4.22 4.22l1.42 1.42m12.72 12.72l1.42 1.42M1 12h2m18 0h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/></svg><span class="weather-temp">æŸ¥çœ‹</span></div>
                <div class="weather-col"><span class="weather-time">å³æ™‚</span><svg class="icon" viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg><span class="weather-temp">å¤©æ°£</span></div>
            </div>
            <div id="itinerary-timeline" style="padding: 0 20px;"></div>
            <button class="add-btn-float" onclick="openAddModal()">
                <svg viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
            </button>
            <div style="height: 50px;"></div>
        `;
        const newTimeline = document.getElementById('itinerary-timeline');

        // æ¸²æŸ“è¡Œç¨‹é …ç›®
        data.items.forEach((item, index) => {
            const tagHtml = `<div class="tag ${tagClasses[item.tag] || ''}">${tagNames[item.tag] || item.tag}</div>`;
            const linkHtml = item.link ? `<a href="${item.link}" class="btn-nav" target="_blank"><svg class="icon" viewBox="0 0 24 24"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h5"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg> åœ°åœ–/ç¶²ç«™</a>` : '';
            
            const itemHtml = `
                <div class="timeline-item" data-index="${index}">
                    <div class="time-badge">${item.time}</div>
                    <div class="card">
                        ${tagHtml}
                        <div class="card-title">${item.title}</div>
                        <div class="desc" style="border-top: none; padding-top: 0; margin-top: 0; line-height: 1.5;">${item.desc}</div>
                        ${linkHtml}
                        <div style="text-align:right; margin-top:15px; border-top: 1px dashed var(--line); padding-top:10px;">
                            <span style="font-size:12px; color:#999; cursor:pointer;" onclick="deleteItem(${dayNum}, ${index})">ğŸ—‘ åˆªé™¤</span>
                        </div>
                    </div>
                </div>
            `;
            newTimeline.innerHTML += itemHtml;
        });

        // é‡æ–°ç¢ºä¿æ—¥æœŸåˆ‡æ›å™¨æ­£ç¢º
        document.querySelectorAll('.date-item').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.date-item')[dayNum-1].classList.add('active');
        document.getElementById('page-title').innerText = dayTitles[dayNum];
        window.scrollTo(0,0);
    }
    
    // --- è¡Œç¨‹ç·¨è¼¯åŠŸèƒ½ (èˆ‡ä¸Šä¸€å€‹ç‰ˆæœ¬ç›¸åŒ) ---
    function openAddModal() {
        document.getElementById('modalDayNum').innerText = currentDay;
        document.getElementById('addModal').style.display = 'flex';
        // é‡è¨­è¡¨å–®
        document.getElementById('itemTime').value = '10:00';
        document.getElementById('itemTitle').value = '';
        document.getElementById('itemDesc').value = '';
        document.getElementById('itemLink').value = '';
        document.getElementById('tag-edit-spot').checked = true; // é è¨­é¸ä¸­æ™¯é»
    }

    function closeModal() {
        document.getElementById('addModal').style.display = 'none';
    }

    function saveNewItem() {
        const time = document.getElementById('itemTime').value;
        const title = document.getElementById('itemTitle').value.trim();
        const desc = document.getElementById('itemDesc').value.trim();
        const link = document.getElementById('itemLink').value.trim();
        const tag = document.querySelector('input[name="itemTag"]:checked').value;

        if (!time || !title) {
            alert('æ™‚é–“å’Œæ¨™é¡Œæ˜¯å¿…å¡«çš„å–”ï¼');
            return;
        }

        const newItem = {
            time: time,
            title: title,
            desc: desc,
            link: link,
            tag: tag
        };

        // æ–°å¢åˆ°ç•¶å‰å¤©çš„è³‡æ–™ä¸­
        itineraryData[currentDay].items.push(newItem);
        
        // ä¾ç…§æ™‚é–“æ’åº (ç¢ºä¿æ–°å¢é …ç›®é †åºæ­£ç¢º)
        itineraryData[currentDay].items.sort((a, b) => (a.time > b.time) ? 1 : -1);

        saveItineraryToLocalStorage();
        renderItinerary(currentDay);
        closeModal();
    }

    function deleteItem(dayNum, itemIndex) {
        if(confirm(`ç¢ºå®šè¦åˆªé™¤ Day ${dayNum} çš„é€™å€‹è¡Œç¨‹é …ç›®å—ï¼Ÿ`)) {
            itineraryData[dayNum].items.splice(itemIndex, 1);
            saveItineraryToLocalStorage();
            renderItinerary(dayNum);
        }
    }

    // --- æ ¸å¿ƒå°èˆªé‚è¼¯ (èˆ‡ä¸Šä¸€å€‹ç‰ˆæœ¬ç›¸åŒ) ---
    function switchDay(dayNum) {
        document.getElementById('itinerary-container').classList.add('active');
        document.getElementById('tools').classList.remove('active');
        document.getElementById('budget').classList.remove('active');
        document.getElementById('main-header').style.display = 'block';

        renderItinerary(dayNum); // å‘¼å«æ–°çš„æ¸²æŸ“å‡½æ•¸
        
        // åº•éƒ¨å°èˆªç‹€æ…‹æ›´æ–°
        document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
        document.querySelector('.bottom-nav .nav-btn:first-child').classList.add('active');
    }

    function switchMainTab(tabName, btnEl) {
        document.getElementById('itinerary-container').classList.remove('active');
        document.getElementById('tools').classList.remove('active');
        document.getElementById('budget').classList.remove('active');
        document.getElementById('main-header').style.display = 'none';
        
        document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('active'));
        btnEl.classList.add('active');

        if(tabName === 'itinerary') {
            document.getElementById('itinerary-container').classList.add('active');
            document.getElementById('main-header').style.display = 'block';
            document.getElementById('page-title').innerText = dayTitles[currentDay];
        } else if (tabName === 'tools') {
            document.getElementById('tools').classList.add('active');
            document.getElementById('main-header').style.display = 'block';
            document.getElementById('page-title').innerText = 'æ—…ç¨‹è³‡è¨Š';
            loadVJWData(); // ç¢ºä¿æ¯æ¬¡åˆ‡æ›åˆ°è³‡è¨Šé é¢æ™‚éƒ½è¼‰å…¥æœ€æ–°çš„ VJW è³‡æ–™
        } else if (tabName === 'budget') {
            document.getElementById('budget').classList.add('active');
            document.getElementById('main-header').style.display = 'block';
            document.getElementById('page-title').innerText = 'æ—…è¡Œè¨˜å¸³';
            loadExpenses();
        }
        window.scrollTo(0,0);
    }

    // --- è¨˜å¸³é‚è¼¯ (èˆ‡ä¸Šä¸€å€‹ç‰ˆæœ¬ç›¸åŒ) ---
    const iconsPath = { food: '<path d="M12 2l7 3v4a9 9 0 0 1-7 8 9 9 0 0 1-7-8V5z"/>', shop: '<path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 0 1-8 0"/>', trans: '<path d="M10 16.5c0 .83-.67 1.5-1.5 1.5s-1.5-.67-1.5-1.5.67-1.5 1.5-1.5 1.5.67 1.5 1.5z"/><path d="M17.5 16.5c0 .83-.67 1.5-1.5 1.5s-1.5-.67-1.5-1.5.67-1.5 1.5-1.5 1.5.67 1.5 1.5z"/><path d="M5 20h14"/>', stay: '<path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/>', other: '<circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/>' };
    const categoryNames = { food: 'é¤é£²', shop: 'è³¼ç‰©', trans: 'äº¤é€š', stay: 'ä½å®¿', other: 'å…¶ä»–' };

    function loadExpenses() {
        const expenses = JSON.parse(localStorage.getItem('tripExpenses')) || [];
        const list = document.getElementById('expenseList');
        let total = 0; list.innerHTML = ''; 
        expenses.slice().reverse().forEach((exp, index) => {
            const originalIndex = expenses.length - 1 - index;
            const li = document.createElement('li'); li.classList.add('expense-item');
            const path = iconsPath[exp.category] || iconsPath['other'];
            const catName = categoryNames[exp.category] || 'å…¶ä»–';
            li.innerHTML = `<div class="expense-item-left"><div class="expense-icon-circle"><svg viewBox="0 0 24 24">${path}</svg></div><div class="expense-info"><span class="expense-name">${exp.item}</span><span class="expense-cat-name">${catName}</span></div></div><div style="display:flex; align-items:center;"><span class="expense-amount">Â¥${exp.amount.toLocaleString('en-US')}</span><span class="delete-btn" onclick="removeExpense(${originalIndex})">Ã—</span></div>`;
            list.appendChild(li); total += exp.amount;
        });
        document.getElementById('totalAmount').innerText = total.toLocaleString('en-US');
    }

    function addExpense() {
        const item = document.getElementById('budgetItem').value.trim();
        const amount = parseInt(document.getElementById('budgetAmount').value, 10); 
        const selectedCat = document.querySelector('input[name="expense-cat"]:checked').value;
        if (item && !isNaN(amount) && amount > 0) {
            const expenses = JSON.parse(localStorage.getItem('tripExpenses')) || [];
            expenses.push({ item, amount, category: selectedCat, timestamp: Date.now() });
            localStorage.setItem('tripExpenses', JSON.stringify(expenses));
            document.getElementById('budgetItem').value = ''; document.getElementById('budgetAmount').value = '';
            loadExpenses();
            document.getElementById('exportOutput').style.display = 'none';
        } else { alert('è«‹è¼¸å…¥æœ‰æ•ˆå…§å®¹ï¼'); }
    }

    function removeExpense(index) {
        if(confirm('åˆªé™¤æ­¤ç´€éŒ„ï¼Ÿ')) {
            const expenses = JSON.parse(localStorage.getItem('tripExpenses')) || [];
            expenses.splice(index, 1);
            localStorage.setItem('tripExpenses', JSON.stringify(expenses));
            loadExpenses();
        }
    }

    function clearBudget() {
        if (confirm('æ¸…é™¤æ‰€æœ‰ç´€éŒ„ï¼Ÿ')) {
            localStorage.removeItem('tripExpenses'); loadExpenses();
        }
    }

    function exportExpensesToCSV() {
        const expenses = JSON.parse(localStorage.getItem('tripExpenses')) || [];
        const outputDiv = document.getElementById('exportOutput');
        const textarea = document.getElementById('csvData');
        if (expenses.length === 0) { alert('ç„¡è³‡æ–™å¯åŒ¯å‡º'); return; }
        
        let csvContent = "åˆ†é¡\té …ç›®\té‡‘é¡ (JPY)\n"; 
        expenses.forEach(exp => { csvContent += `${categoryNames[exp.category]}\t${exp.item}\t${exp.amount}\n`; });
        textarea.value = csvContent;
        outputDiv.style.display = 'block'; textarea.select(); alert('è³‡æ–™å·²ç”Ÿæˆï¼Œè«‹è¤‡è£½æ–‡å­—è²¼åˆ° Excel');
    }

    // Header Scroll Effect
    window.addEventListener('scroll', () => {
        const header = document.querySelector('header');
        if (window.scrollY > 10) header.classList.add('scrolled');
        else header.classList.remove('scrolled');
    });
</script>
</body>
</html>